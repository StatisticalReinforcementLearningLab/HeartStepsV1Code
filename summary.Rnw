\documentclass{article}

%\usepackage[margin=1in]{geometry}
\usepackage{microtype}
\usepackage{amsfonts,amssymb,amsbsy,amsmath,amsthm,mathtools}
\usepackage[onehalfspacing]{setspace}
\usepackage{times}
\IfFileExists{mtpro2.sty}
  {\let\Bbbk\relax\usepackage[mtphrb]{mtpro2}}
  {\usepackage{mathptmx}}

\title{HeartSteps data summary}
\author{}
\usepackage{graphicx}

\begin{document}
\maketitle
  
  % To include and evaluate R code inside knitr, enclose the code block in a "chunk". Open the chunk with << >>=, enclosing chunk name and options inside the brackets (See http://yihui.name/knitr/options/#chunk_options for chunk options). There can't be any line breaks in << >> and options are separated by commas. Close the chunk with @. Objects created inside chunks are global.
  
  % Read in the data: must be done by knitr (for some reason it can't read the global environment unless it creates it?). Options: don't _include_ output in the final .tex file. It's possible to somehow cache chunks, but there seem to be some nuanced best practices that I haven't quite gotten a grip on yet. I'll update when I do.
  
<<read_data, echo = FALSE, include = FALSE>>=
source("init.R")
setwd(mbox)
load("analysis.RData")
@

\section{Issues}

Instances of all but the last of the following scenarios are small:

\begin{itemize}
\item Planning and EMA response resubmitted the next day
\item No available contextual data for planning
\item Momentary decision (to provide an activity suggestion or not) identifier persisting to the next time slot
\item Notifications sent outside time slots after time zone change
\item Lack of time zone information with EMA response and changes to application settings (home/work locations and calendars)
\item Calendar data (apart from busyness status for momentary decision) unavailable
\end{itemize}

\section{Step count}
  
<<steps, echo = FALSE, out.height = "\\textheight", out.width = "\\textwidth", fig.align = "center">>=
sapply(sort(unique(steps$user)), function(u)
  sapply(sort(unique(with(steps, end.datetime.yday[user == u]))), function(d)
    with(subset(steps, user == u & end.datetime.yday == d),
         plot((end.utime - min(end.utime))/(60*60), cumsum(steps),
              type = "s", xlab = "Hours", ylab = "Cumulative steps",
              main = paste("User", user[1])))))
@

\end{document}
